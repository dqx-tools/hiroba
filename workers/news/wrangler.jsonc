{
  // Cloudflare Workers configuration for DQX News API
  // Deploy using: npx wrangler deploy (from this directory)

  "name": "dqx-news-api",
  "main": "worker.py",
  "compatibility_date": "2025-11-22",
  "compatibility_flags": ["python_workers"],

  "observability": {
    "enabled": true
  },

  // D1 Database binding for caching translations
  "d1_databases": [
    {
      "binding": "DB",
      "database_name": "dqx-news-cache"
    }
  ],

  // Environment variables
  "vars": {
    "OPENAI_MODEL": "gpt-5.1"
  },

  // Cron trigger for hourly news refresh
  "triggers": {
    "crons": ["0 * * * *"] // Every hour at minute 0
  },

  // Production environment
  "env": {
    "production": {
      "name": "dqx-news-api",
      "routes": [
        { "pattern": "hiroba-api.dqx.tools/news*", "zone_name": "dqx.tools" },
        { "pattern": "hiroba-api.dqx.tools/categories*", "zone_name": "dqx.tools" },
        { "pattern": "hiroba-api.dqx.tools/health*", "zone_name": "dqx.tools" },
        { "pattern": "hiroba-api.dqx.tools/refresh*", "zone_name": "dqx.tools" }
      ],
      "vars": {
        "OPENAI_MODEL": "gpt-5.1"
      },
      "d1_databases": [
        {
          "binding": "DB",
          "database_name": "dqx-news-cache"
        }
      ],
      "triggers": {
        "crons": ["0 * * * *"]
      }
    },

    // Staging environment
    "staging": {
      "name": "dqx-news-api-staging",
      "vars": {
        "OPENAI_MODEL": "gpt-4.5-preview"
      },
      "d1_databases": [
        {
          "binding": "DB",
          "database_name": "dqx-news-cache-staging"
        }
      ]
    }
  },

  // Development settings
  "dev": {
    "port": 8787,
    "local_protocol": "http"
  }
}
